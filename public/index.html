<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Todo List â€“ FastAPI on Vercel</title>
  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji'; }
    body { margin: 0; background: #f6f7fb; color: #111; }
    .container { max-width: 720px; margin: 40px auto; background: #fff; padding: 24px; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.06); }
    h1 { margin: 0 0 12px; font-size: 24px; }
    p.muted { margin-top: 0; color: #666; }
    .row { display: flex; gap: 8px; margin: 16px 0; }
    input[type=text] { flex: 1; padding: 12px 14px; border-radius: 10px; border: 1px solid #ddd; outline: none; }
    button { padding: 10px 14px; border: 0; border-radius: 10px; background: #111; color: #fff; cursor: pointer; }
    button.secondary { background: #e9eaee; color: #111; }
    ul { list-style: none; padding: 0; margin: 16px 0 0; }
    li { display: flex; align-items: center; gap: 10px; padding: 12px 10px; border: 1px solid #eee; border-radius: 12px; margin-bottom: 10px; background: #fafbff; }
    .title { flex: 1; }
    .done { text-decoration: line-through; color: #888; }
    .badge { font-size: 12px; padding: 2px 8px; border-radius: 999px; background: #eef2ff; color: #334; }
    .actions { display: flex; gap: 6px; }
    .empty { text-align: center; color: #777; padding: 20px 0; }
    .footer { display:flex; justify-content: space-between; align-items:center; margin-top: 10px; color:#555; }
    a { color:#111; }
  </style>
</head>
<body>
  <div class="container">
    <h1>âœ… Todo List</h1>
    <p class="muted">FastAPI + Vercel (tanpa DB). Data akan hilang saat instance serverless direstart.</p>

    <div class="row">
      <input id="todo-input" type="text" placeholder="Tulis todo baru, misal: Belajar FastAPI" />
      <button id="add-btn">Tambah</button>
    </div>

    <div class="footer">
      <div><span class="badge"><span id="count-done">0</span> selesai</span> â€¢ <span class="badge"><span id="count-total">0</span> total</span></div>
      <div>
        <button class="secondary" id="refresh-btn">Muat ulang</button>
      </div>
    </div>

    <ul id="todo-list"></ul>

    <p class="empty" id="empty-state" style="display:none;">Belum ada todo. Tambahkan di atas ðŸ‘†</p>

    <div style="margin-top:20px;">
      <a href="/docs" target="_blank" rel="noopener">Open API Docs (Swagger)</a> â€¢
      <a href="/redoc" target="_blank" rel="noopener">ReDoc</a>
    </div>
  </div>

  <script>
    // Jika kamu hosting HTML ini di domain berbeda dari API, isi API_BASE dengan URL API-mu.
    // Contoh: const API_BASE = "https://todo-fastapi-yourname.vercel.app";
    const API_BASE = "https://todo-list-gamma-six-49.vercel.app/"; // same-origin

    const $ = (sel) => document.querySelector(sel);
    const listEl = $("#todo-list");
    const inputEl = $("#todo-input");
    const emptyEl = $("#empty-state");
    const countDoneEl = $("#count-done");
    const countTotalEl = $("#count-total");
    const addBtn = $("#add-btn");
    const refreshBtn = $("#refresh-btn");

    async function fetchJSON(url, options = {}) {
      const res = await fetch(url, {
        headers: { "Content-Type": "application/json" },
        ...options
      });
      if (!res.ok) {
        const text = await res.text();
        throw new Error(`HTTP ${res.status}: ${text}`);
      }
      return res.json();
    }

    function render(todos) {
      listEl.innerHTML = "";
      if (!todos.length) {
        emptyEl.style.display = "block";
      } else {
        emptyEl.style.display = "none";
      }

      let doneCount = 0;

      for (const t of todos) {
        if (t.done) doneCount++;

        const li = document.createElement("li");

        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = !!t.done;
        checkbox.addEventListener("change", async () => {
          try {
            await updateTodo(t.id, { title: t.title, done: checkbox.checked });
            await loadTodos();
          } catch (e) {
            alert("Gagal update: " + e.message);
          }
        });

        const title = document.createElement("div");
        title.className = "title" + (t.done ? " done" : "");
        title.textContent = t.title;

        const actions = document.createElement("div");
        actions.className = "actions";

        const editBtn = document.createElement("button");
        editBtn.className = "secondary";
        editBtn.textContent = "Edit";
        editBtn.addEventListener("click", async () => {
          const newTitle = prompt("Ubah judul todo:", t.title);
          if (newTitle === null) return;
          if (!newTitle.trim()) return alert("Judul tidak boleh kosong.");
          try {
            await updateTodo(t.id, { title: newTitle.trim(), done: t.done });
            await loadTodos();
          } catch (e) {
            alert("Gagal edit: " + e.message);
          }
        });

        const delBtn = document.createElement("button");
        delBtn.textContent = "Hapus";
        delBtn.addEventListener("click", async () => {
          if (!confirm(`Hapus "${t.title}"?`)) return;
          try {
            await deleteTodo(t.id);
            await loadTodos();
          } catch (e) {
            alert("Gagal hapus: " + e.message);
          }
        });

        actions.append(editBtn, delBtn);
        li.append(checkbox, title, actions);
        listEl.appendChild(li);
      }

      countDoneEl.textContent = doneCount;
      countTotalEl.textContent = todos.length;
    }

    async function loadTodos() {
      try {
        const todos = await fetchJSON(`${API_BASE}/todos`);
        render(todos);
      } catch (e) {
        alert("Gagal memuat todos: " + e.message);
      }
    }

    async function addTodo(title) {
      return fetchJSON(`${API_BASE}/todos`, {
        method: "POST",
        body: JSON.stringify({ title, done: false })
      });
    }

    async function updateTodo(id, payload) {
      return fetchJSON(`${API_BASE}/todos/${id}`, {
        method: "PUT",
        body: JSON.stringify(payload)
      });
    }

    async function deleteTodo(id) {
      return fetchJSON(`${API_BASE}/todos/${id}`, { method: "DELETE" });
    }

    addBtn.addEventListener("click", async () => {
      const title = inputEl.value.trim();
      if (!title) return inputEl.focus();
      try {
        await addTodo(title);
        inputEl.value = "";
        await loadTodos();
      } catch (e) {
        alert("Gagal menambah: " + e.message);
      }
    });

    refreshBtn.addEventListener("click", loadTodos);

    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") addBtn.click();
    });

    loadTodos();
  </script>
</body>
</html>
